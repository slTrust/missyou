### 2-1 SpringBoot最基础的编程模式@Component+@Autowired

> XML方式:以前没注解的时候，不推荐使用了

#### 注解

##### steretype annotations 模式注解

`@Component` 加在类上面，这个类就由 spring boot 自动帮你把类加入到容器里去，它负责这个类的实例化


```
@Component
public class Diana {
    public void q(){
        System.out.println("Diana Q");
    }
}
```

`@Service` 效果同上

```
@Service
public class BannerService {
}
```

**注入** 同时你需要用到的地方添加 `@Autowired`

```
@RestController
@RequestMapping("/v1/banner")
public class BannerController {

    @Autowired
    private Diana diana;

    @Autowired
    private BannerService service;

    @GetMapping("/test")
    public String test2() {
        diana.q();
        return "Hello,亚瑟";
    }
}
```

### 2-2 Stereotype Annotations 模式注解

- `@Component` 最基础的模式注解
    - 把一个组件/类/bean加入到容器中

> 以下都是以 `@Component` 为基础的衍生注解

- `@Service` 标明是种服务
- `@Controller` 标明是个控制器
- `@RestController` 标明是个restful 的 控制器 
- `@Repository` 标明是个仓储
- `@Configuration` 更灵活的方式 把一组bean加入到容器里
    - 跟上面的有些不同
    - 具体参考[@Configuration 注解介绍](https://www.jianshu.com/p/721c76c1529c)
    

### 2-3 Spring的实例化和依赖注入时机与延迟实例化

> 查看这样一个问题

- Diana 那个类如果没有`@Component` 注解，只是在 BannerController 里 `@Autowired` 就会报错
    - 如果 spring 无法从容器里找到 Diana 这个类，它就会报错

```
@RestController
@RequestMapping("/v1/banner")
public class BannerController {

    @Autowired
    private Diana diana;

    @Autowired
    private BannerService service;

    @GetMapping("/test")
    public String test2() {
        diana.q();
        return "Hello,亚瑟";
    }
}
```

> 如何允许 未添加 `@Component` 注解的类 为空值

```
@Autowired(required = false)
private Diana diana;
``` 

> IOC 对象实例化注入时机

- 在Spring启动的时候就开始 对象的实例化 并注入
- 这是一个默认的机制 **立即/提前 实例化**
    - 延迟实例化 `@Lazy`


> `@Lazy` 问题

Diana.java

```
@Component
@Lazy
public class Diana {
    public void q(){
        System.out.println("Diana Q");
    }
}
```

BannerController.java

```
@RestController
@RequestMapping("/v1/banner")
public class BannerController {

    @Autowired
    private Diana diana;

    @GetMapping("/test")
    public String test2() {
        diana.q();
        return "Hello,亚瑟";
    }
}
```

**此时 BannerController 依赖了 Diana，所以 `@Lazy`失效**

解决办法： 在 BannerController 上也添加 `@Lazy`

这样在你访问接口的时候 `v1/banner/test`时才会进行实例化

### 2-4 成员变量注入、Setter注入与构造注入

> 其实 @Autowired 是不推荐的 idea里鼠标悬停会有提示警告

- 但它是写起来最方便的

> 推荐的注入方式： 构造器注入

```
@RestController
@RequestMapping("/v1/banner")
public class BannerController {

    private Diana diana;

    public BannerController(Diana diana){
        this.diana = diana;
    }

    @GetMapping("/test")
    public String test2() {
        diana.q();
        return "Hello,亚瑟";
    }
}

```

> 还有一个不常见的注入：set注入

```
@RestController
@RequestMapping("/v1/banner")
public class BannerController {
    private Diana diana;

    @Autowired
    public void setDiana(Diana diana) {
        this.diana = diana;
    }

    @GetMapping("/test")
    public String test2() {
        diana.q();
        return "Hello,亚瑟";
    }
}

```